import * as React from 'react';
import './RestaurantCards.scss';
import yelp_icon_white from './yelp_icon_white.png';
import yelp_icon_black from './yelp_icon_black.png';
import Dropdown from '../Dropdown/AddToList';
import { UserLists } from '../../types';
// import AddToList from '../AddToListButton'
// import StarRatings from '../StarRatings/StarRatings';

interface Props {
  id: string,
  addToList: ((listName: string, id: string) => void),
  name: string,
  rating: number,
  image: string,
  location: string[],
  phone: string,
  url: string,
  key: string
  userLists: UserLists
}

interface State {
  dropdownOpen: boolean
}

class HomeCard extends React.Component<Props, State> {
  state: State = {
    dropdownOpen: false
  }

  componentDidUpdate = () => {
    window.addEventListener('scroll', this.closeDropdown);
  }

  displayAddress = (address: string[]) => {
    return address.map((element, index) => 
      <p key={index} className='address'>{element}</p>
    )
  }

  displayDropdown = () => {
    this.setState(prevState => ({ 
      dropdownOpen: !prevState.dropdownOpen
    }))
  }

  closeDropdown = () => {
    this.setState({ dropdownOpen: false })
  }

  handleClick = (key: string) => {
    this.props.addToList(key, this.props.id);
    this.displayDropdown();
  }

  populateDropdown = () => {
    const keys = Object.keys(this.props.userLists)
    return keys.map((key, index) => {
      return (
        <li className='dropdown-item' key={index} id={`${key}-id`} data-cy={key} tabIndex={0} onClick={() => this.handleClick(key)}>{this.props.userLists[key].displayName}
        </li>
      )
    })
  }

  render() {
    const dropDownList = this.state.dropdownOpen &&
      <ul id="myDropdown" className="dropdown-content">
        {this.populateDropdown()}
        <li className='dropdown-item'><a href='http://localhost:3000/gottago/#newList'>Create A New List</a></li>
      </ul>

    return (
      <section className='home-card'>
        <img className='thumbnail' src={this.props.image} alt={`Photo of ${this.props.name}`} tabIndex={0}/>
        <article className='restaurant-info'>
        <h2 className='name' tabIndex={0}>{this.props.name}</h2>
          <p className='rating' tabIndex={0}>Rating: {this.props.rating}</p>
          <p className='phone-number'>
            <a href='tel:{props.phone}' className='phone-link' aria-label='phone number'>{this.props.phone}</a>
          </p>
          <div className='address-container' tabIndex={0}>
            {this.displayAddress(this.props.location)}
          </div>
        </article>
        <article className='card-buttons'>
          <div className="dropdown">
            <button className="dropdown-btn" tabIndex={0} onClick={ () => this.displayDropdown() }> Add to List
            <i className="fa fa-chevron-down fa-flip-horizontal"></i>
            </button>
              { dropDownList }
          </div>
          <div className='yelp'>
            <a href={this.props.url} target='_blank' tabIndex={-1}>
              <button className='more-info'>View On Yelp
                <img src={yelp_icon_white} alt='visit yelp page' className='yelp-logo-white'/>
                <img src={yelp_icon_black} alt='visit yelp page' className='yelp-logo-black'/>
              </button>
            </a>
          </div>
        </article>
      </section>
    )
  }
}

export default HomeCard;